<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Mobil reszponzivitás -->
    <title>Belépő vonalkód generátor</title>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <style>
        /* Alapértelmezett stílusok */
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
            max-width: 480px;
            margin: 30px auto;
            box-sizing: border-box;
        }

        h2 {
            font-size: 24px;
            margin-bottom: 20px;
        }

        #form {
            margin-bottom: 20px;
        }

        input {
            width: 100%;  /* Szélesség 100% legyen, hogy alkalmazkodjon a képernyőhöz */
            padding: 10px;
            font-size: 16px;
            box-sizing: border-box; /* A padding ne növelje meg a szélességet */
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            margin-top: 10px;
        }

        #barcode {
            margin-top: 20px;
            max-width: 100%; /* Biztosítja, hogy a vonalkód nem lépi túl a képernyő szélességét */
        }

        /* Media query mobil eszközökhöz */
        @media (max-width: 600px) {
            h2 {
                font-size: 20px;
            }

            button {
                width: 100%; /* Gomb szélessége mobilon */
                font-size: 18px;
            }

            input {
                font-size: 18px; /* Nagyobb betűméret mobilon */
            }
        }

    </style>
</head>
<body>

<h2>Vonalkód generátor</h2>

<div id="form">
    <label for="nameInput">Név:</label><br>
    <input id="nameInput" type="text" placeholder="Add meg a neved"><br><br>
    <button id="saveBtn">Generálás</button>
</div>

<svg id="barcode"></svg>

<script>
// ------------------- Numerikus mapping -------------------
function nameToCode(name){
    const map = {};
    let i=1;
    for(let c="A".charCodeAt(0);c<="Z".charCodeAt(0);c++) map[String.fromCharCode(c)] = i++;
    for(let c="a".charCodeAt(0);c<="z".charCodeAt(0);c++) map[String.fromCharCode(c)] = i++;
    map[" "] = 0; map["-"]=53;
    let code="";
    for(const ch of name){
        code += (map[ch]!==undefined ? String(map[ch]).padStart(2,"0") : "99");
    }
    if(code.length>10) code=code.substring(0,10); // max 10 számjegy
    return code;
}

// ------------------- Device és cookie -------------------
function getDeviceId(){
    let did = localStorage.getItem("deviceId") || getCookie("deviceId");
    if(!did){
        did = crypto.randomUUID();
        try{ document.cookie="deviceId="+did+"; path=/; max-age=31536000"; }catch(e){}
        localStorage.setItem("deviceId",did);
    }
    return did;
}

function getCookie(name){
    const v=document.cookie.match('(^|;) ?'+name+'=([^;]*)(;|$)');
    return v? decodeURIComponent(v[2]):null;
}

const deviceId = getDeviceId();

// ------------------- Mentés -------------------
const saveBtn = document.getElementById("saveBtn");
const nameInput = document.getElementById("nameInput");

// ------------------- Betöltés -------------------
function loadBarcode() {
    const savedCode = getCookie("barcodeCode") || localStorage.getItem("barcodeCode");
    const savedName = getCookie("userName") || localStorage.getItem("userName");
    
    if (savedCode) {
        JsBarcode("#barcode", savedCode, { format: "CODE128", width: 2, height: 60, displayValue: true });
        document.getElementById("form").style.display = "none";
    } else if (savedName) {
        nameInput.value = savedName;
    }
}

loadBarcode();

// ------------------- Generálás -------------------
saveBtn.addEventListener("click", () => {
    // Ellenőrizzük a korábbi mentést
    const existingName = localStorage.getItem("userName") || getCookie("userName");
    if (existingName && existingName.trim() !== "") {
        return alert("Eszközön már megadtad a neved!");
    }

    const name = nameInput.value.trim();
    if (!name) return alert("Add meg a neved!");

    const code = nameToCode(name);
    JsBarcode("#barcode", code, { format: "CODE128", width: 2, height: 60, displayValue: true });

    // Mentés cookie-ba és localStorage-ba
    localStorage.setItem("userName", name);
    localStorage.setItem("barcodeCode", code);
    try {
        document.cookie = "userName=" + encodeURIComponent(name) + "; path=/; max-age=31536000";
        document.cookie = "barcodeCode=" + encodeURIComponent(code) + "; path=/; max-age=31536000";
    } catch (e) {}

    document.getElementById("form").style.display = "none";
});
</script>

</body>
</html>
